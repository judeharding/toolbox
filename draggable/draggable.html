<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<title>Drag & Drop DTO Example</title>
		<style>
			.wrapper {
				display: flex;
				gap: 40px;
				margin-top: 20px;
			}
			.container {
				display: flex;
				flex-direction: column;
				gap: 8px;
				width: 200px;
				min-height: 150px;
				padding: 10px;
				border: 2px dashed #bbb;
				border-radius: 6px;
				background: #f9f9f9;
			}
			.item {
				padding: 10px;
				border: 1px solid #999;
				background: #eee;
				cursor: grab;
			}
			.dragging {
				opacity: 0.5;
			}
			.counter {
				margin-top: 10px;
				font-weight: bold;
				color: #555;
			}
		</style>
	</head>
	<body>
		<div class="wrapper">
			<div>
				<div class="container" id="container1">
					<div class="item" draggable="true" data-id="mike">Item 1</div>
					<div class="item" draggable="true" data-id="jude">Item 2</div>
					<div class="item" draggable="true" data-id="scott">Item 3</div>
				</div>
				<div class="counter" id="counter1"></div>
			</div>

			<div>
				<div class="container" id="container2">
					<div class="item" draggable="true" data-id="ken">Item 1</div>
					<div class="item" draggable="true" data-id="marie">Item 2</div>
				</div>
				<div class="counter" id="counter2"></div>
			</div>

			<div>
				<div class="container" id="container3"></div>
				<div class="counter" id="counter3"></div>
			</div>
		</div>

		<script>
			var containers = document.querySelectorAll(".container");

			// Loop through each container
			for (let i = 0; i < containers.length; i++) {
				let container = containers[i];

				// Drag start
				container.addEventListener("dragstart", function (e) {
					var dragging = e.target;
					dragging.classList.add("dragging");

					// Find original position
					var parentItems = dragging.parentElement.querySelectorAll(".item");
					var originalPosition = 0;
					for (var j = 0; j < parentItems.length; j++) {
						if (parentItems[j] === dragging) {
							originalPosition = j + 1;
							break;
						}
					}

					// Store info in DataTransfer
					var dragInfo = {
						id: dragging.dataset.id,
						originalContainer: dragging.parentElement.id,
						originalPosition: originalPosition,
					};
					e.dataTransfer.setData("application/json", JSON.stringify(dragInfo));
				});

				// Drag over (needed to allow drop)
				container.addEventListener("dragover", function (e) {
					e.preventDefault();
					var dragging = document.querySelector(".dragging");
					var afterElement = getDragAfterElement(container, e.clientY);
					if (afterElement == null) {
						container.appendChild(dragging);
					} else {
						container.insertBefore(dragging, afterElement);
					}
				});

				// Drop
				container.addEventListener("drop", function (e) {
					e.preventDefault();
					var dragging = document.querySelector(".dragging");
					if (!dragging) return;
					dragging.classList.remove("dragging");

					// Retrieve original info
					var dragInfo = JSON.parse(e.dataTransfer.getData("application/json"));

					// Compute new position
					var newItems = dragging.parentElement.querySelectorAll(".item");
					var newPosition = 0;
					for (var j = 0; j < newItems.length; j++) {
						if (newItems[j] === dragging) {
							newPosition = j + 1;
							break;
						}
					}

					// Log the DTO

					console.log("id: ", dragInfo.id);
					console.log("originalContainer: ", dragInfo.originalContainer);
					console.log("originalIndex: ", dragInfo.originalPosition);
					console.log("newContainer: ", dragging.parentElement.id);
					console.log("newIndex: ", newPosition);

					// Update numbering and counters
					updateAll();
				});
			}

			// Helper: find element after cursor
			function getDragAfterElement(container, y) {
				var draggableElements = container.querySelectorAll(".item:not(.dragging)");
				var closest = { offset: Number.NEGATIVE_INFINITY, element: null };
				for (var i = 0; i < draggableElements.length; i++) {
					var child = draggableElements[i];
					var box = child.getBoundingClientRect();
					var offset = y - box.top - box.height / 2;
					if (offset < 0 && offset > closest.offset) {
						closest = { offset: offset, element: child };
					}
				}
				return closest.element;
			}

			// Update numbering and counters
			function updateAll() {
				for (var i = 0; i < containers.length; i++) {
					var container = containers[i];
					var items = container.querySelectorAll(".item");
					for (var j = 0; j < items.length; j++) {
						items[j].dataset.position = j + 1;
						items[j].textContent = "Item " + (j + 1) + " (id=" + items[j].dataset.id + ")";
					}
					var counterId = container.id.replace("container", "counter");
					var counter = document.getElementById(counterId);
					if (counter) {
						counter.textContent = "Total items: " + items.length;
					}
				}
			}

			// Initialize on load
			updateAll();

			// const containers = document.querySelectorAll(".container");

			// containers.forEach((container) => {
			// 	container.addEventListener("dragstart", (e) => {
			// 		const dragging = e.target;
			// 		dragging.classList.add("dragging");

			// 		// Store original container and position in DataTransfer
			// 		const parentItems = [...dragging.parentElement.querySelectorAll(".item")];
			// 		const dragInfo = {
			// 			id: dragging.dataset.id,
			// 			originalContainer: dragging.parentElement.id,
			// 			originalPosition: parentItems.indexOf(dragging) + 1,
			// 		};
			// 		e.dataTransfer.setData("application/json", JSON.stringify(dragInfo));
			// 	});

			// 	container.addEventListener("dragover", (e) => {
			// 		e.preventDefault();
			// 		const dragging = document.querySelector(".dragging");
			// 		const afterElement = getDragAfterElement(container, e.clientY);
			// 		if (afterElement == null) {
			// 			container.appendChild(dragging);
			// 		} else {
			// 			container.insertBefore(dragging, afterElement);
			// 		}
			// 	});

			// 	container.addEventListener("drop", (e) => {
			// 		e.preventDefault();
			// 		const dragging = document.querySelector(".dragging");
			// 		if (!dragging) return;
			// 		dragging.classList.remove("dragging");

			// 		// Retrieve original info from DataTransfer
			// 		const dragInfo = JSON.parse(e.dataTransfer.getData("application/json"));

			// 		// Compute new position
			// 		const newItems = [...dragging.parentElement.querySelectorAll(".item")];
			// 		const newPosition = newItems.indexOf(dragging) + 1;

			// 		// Log DTO: original + new info
			// 		console.log({
			// 			id: dragInfo.id,
			// 			originalContainer: dragInfo.originalContainer,
			// 			originalPosition: dragInfo.originalPosition,
			// 			newContainer: dragging.parentElement.id,
			// 			newPosition: newPosition,
			// 		});

			// 		// Update numbering and counters
			// 		updateAll();
			// 	});
			// });

			// // Helper to find element after cursor
			// function getDragAfterElement(container, y) {
			// 	const draggableElements = [...container.querySelectorAll(".item:not(.dragging)")];
			// 	return draggableElements.reduce(
			// 		(closest, child) => {
			// 			const box = child.getBoundingClientRect();
			// 			const offset = y - box.top - box.height / 2;
			// 			if (offset < 0 && offset > closest.offset) {
			// 				return { offset: offset, element: child };
			// 			} else {
			// 				return closest;
			// 			}
			// 		},
			// 		{ offset: Number.NEGATIVE_INFINITY }
			// 	).element;
			// }

			// // Update numbering and counters
			// function updateAll() {
			// 	containers.forEach((container) => {
			// 		const items = container.querySelectorAll(".item");
			// 		items.forEach((item, index) => {
			// 			item.dataset.position = index + 1;
			// 			item.textContent = `Item ${index + 1} (id=${item.dataset.id})`;
			// 		});
			// 		const counter = document.getElementById(container.id.replace("container", "counter"));
			// 		counter.textContent = `Total items: ${items.length}`;
			// 	});
			// }

			// // Initialize on load
			// updateAll();
		</script>
	</body>
</html>

<!-- 

					// -----
					// Build DTO THIS WORKS in the scripting section
					// const dto = {
					// 	id: dragData.id,
					// 	originalContainer: dragData.originalContainer,
					// 	originalPosition: dragData.originalPosition,
					// 	newContainer: dragging.parentElement.id,
					// 	newPosition: newPosition,
					// };

					// console.log("Drag DTO:", dto);
					// console.log("Record Id:", dto.id);
					// console.log("Original Container:", dto.originalContainer);
					// console.log("Original Index:", dto.originalPosition);
					// console.log("New Container:", dto.newContainer);
					// console.log("New Index:", dto.newPosition);
					// ----- -->
