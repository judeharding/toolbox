<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<title>Drag & Drop DTO (data transfer object) Example</title>
		<style>
			.wrapper {
				display: flex;
				flex-direction: column;
				gap: 40px;
				margin-top: 20px;
				width: 100%;
			}
			.container {
				display: flex;
				flex-direction: column;
				gap: 8px;
				min-height: 150px;
				padding: 10px;
				border: 2px dashed #bbb;
				border-radius: 6px;
				background: #f9f9f9;
			}
			.item {
				padding: 10px;
				border: 1px solid #999;
				background: #eee;
				cursor: grab;
			}
			.dragging {
				opacity: 0.5;
			}

			.draggingover {
				background: pink;
			}

			.dragTargetOver {
				border-top: 2px solid red;
			}

			.dragTargetUnder {
				border-bottom: 2px solid red;
			}
		</style>
	</head>
	<body>
		<div class="wrapper">
			<div>
				<div class="container" id="container1">
					<div id="mike" class="item" draggable="true" data-container-id="container1">mike</div>
					<div id="jude" class="item" draggable="true" data-container-id="container1">jude</div>
					<div id="scott" class="item" draggable="true" data-container-id="container1">scott</div>
				</div>
			</div>

			<div>
				<div class="container" id="container2">
					<div id="ken" class="item" draggable="true" data-container-id="container2">ken</div>
					<div id="marie" class="item" draggable="true" data-container-id="container2">marie</div>
				</div>
			</div>

			<div>
				<div class="container" id="container3">
					<div id="bree" class="item" draggable="true" data-container-id="container3">bree</div>
					<div id="gene" class="item" draggable="true" data-container-id="container3">gene</div>
				</div>
			</div>
		</div>

		<script>
			let draggedElement = null;
			let draggedElementId = null;
			let topBottomHalf = null;
			let targetId = null;
			let oldContainerId = null;
			let newContainerId = null;

			// STARTING THE DRAG
			document.addEventListener("dragstart", function (event) {
				draggedElement = event.target;
				draggedElementId = event.target.id;
				oldContainerId = event.target.getAttribute("data-container-id");
				console.log("STARTING THE DRAG...", event.target);
				draggedElement.classList.add("dragging");
			});

			// DRAGGING ENTERING A VALID DROP TARGET
			document.addEventListener("dragenter", function (event) {
				// console.log("DRAG ENTER...", event.target.id);
				if (event.target.classList.contains("item")) {
					event.target.classList.add("draggingover");
				}
			});

			// DRAGGING OVER A VALID DROP TARGET
			document.addEventListener("dragover", function (event) {
				event.preventDefault();
				if (event.target.classList.contains("item")) {
					console.log("DRAGGING OVER...", event.target.id);
				}

				const rect = event.target.getBoundingClientRect();
				const offset = event.clientY - rect.top;

				if (offset < rect.height / 2) {
					if (event.target.classList.contains("item")) {
						event.target.classList.add("dragTargetOver");
						event.target.classList.remove("dragTargetUnder");
						topBottomHalf = "top";
					}
				} else {
					if (event.target.classList.contains("item")) {
						event.target.classList.add("dragTargetUnder");
						event.target.classList.remove("dragTargetOver");
						topBottomHalf = "bottom";
					}
				}
			});

			// DRAG LEAVING A VALID DROP TARGET
			document.addEventListener("dragleave", function (event) {
				if (event.target.classList.contains("item")) {
					event.target.classList.remove("draggingover");
					event.target.classList.remove("dragTargetOver");
					event.target.classList.remove("dragTargetUnder");
				}
			});

			//DRAG DROP - Where You Dropped The Element
			document.addEventListener("drop", function (event) {
				event.preventDefault();
				if (event.target.classList.contains("item")) {
					targetId = event.target.id;
					newContainerId = event.target.getAttribute("data-container-id");
					// console.log("DRAGDROPEVENT", draggedElementId, topBottomHalf, targetId, oldContainerId, newContainerId);
					console.log("DRAGDROP EVENT");
					console.log("Element Id is...", draggedElementId);
					console.log("Top or bottom half = ", topBottomHalf);
					console.log("Target Id is...", targetId);
					console.log("OLD container Id is...", oldContainerId);
					console.log("NEW container Id is...", newContainerId);
				}

				event.target.classList.remove("draggingover");
			});

			// ENDED THE DRAGGED ELEMENT - like hitting the esc or dragging over a non valid drop target WHILE dragging
			document.addEventListener("dragend", function (event) {
				console.log("ENDING THE DRAG...", draggedElement);
				draggedElement.classList.remove("dragging");
				// console.log("");
				draggedElement = null;
				// Select all elements with class "item"
				const items = document.querySelectorAll(".item");

				// Loop through each and remove the "xxx" class
				for (let i = 0; i < items.length; i++) {
					items[i].classList.remove("dragTargetOver");
					items[i].classList.remove("dragTargetUnder");
				}
			});
		</script>
	</body>
</html>
