<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<!-- needed for mobile first -->
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />

		<!-- defer below will run AFTER html has been processed -->
		<!-- <script src="./script.js" defer></script> -->

		<title>Testing Draggables</title>

		<!-- STYLES -->
		<style>
			body {
				background-color: pink;
				margin: 5px;
			}

			.container {
				background-color: #333;
				padding: 1rem;
				margin-top: 1rem;
			}

			.draggable {
				padding: 1rem;
				background-color: lightblue;
				border: 5px solid yellow;
				cursor: move;
			}

			.draggable.dragging {
				opacity: 0.5;
				border-top: 5px solid red;
			}
		</style>
	</head>

	<body>
		<h1>Testing Draggables</h1>

		<button id="home">back to home</button>
		<hr />

		<div>
			<div class="container" id="container1">
				<div class="draggable" draggable="true" id="container1div1" data-stuff="box1">Box 1</div>
				<div class="draggable" draggable="true" id="container1div2" data-stuff="box2">Box 2</div>
			</div>
		</div>

		<div class="container" id="container2">
			<div class="draggable" draggable="true" id="container2div1" data-stuff="box3">Box 3</div>
			<div class="draggable" draggable="true" id="container2div2" data-stuff="box4">Box 4</div>
		</div>

		<div class="container">
			<div class="draggable" draggable="true">5</div>
			<div class="draggable" draggable="true">6</div>
		</div>

		<div class="container">
			<div class="draggable" draggable="true">7</div>
			<div class="draggable" draggable="true">8</div>
			<div class="draggable" draggable="true">9</div>
			<div class="draggable" draggable="true">10</div>
			<!-- <div class="draggable" draggable="true">11</div>
			<div class="draggable" draggable="true">12</div>
			<div class="draggable" draggable="true">13</div>
			<div class="draggable" draggable="true">14</div>
			<div class="draggable" draggable="true">15</div>
			<div class="draggable" draggable="true">16</div> -->
		</div>

		<script>
			//HOME BUTTON SCRIPT
			document.getElementById("home").addEventListener("click", () => {
				window.location.href = "../index.html";
			});
		</script>

		<script>
			// https://www.youtube.com/watch?v=jfYWwQrtzzY
			console.log("hello from draggable.html script");

			const draggables = document.querySelectorAll(".draggable");
			const containers = document.querySelectorAll(".container");

			draggables.forEach((draggable) => {
				// var originalContainer = draggable.parentElement.id;
				// var originalDataStuff = draggable.getAttribute("data-stuff");

				draggable.addEventListener("dragstart", () => {
					console.log("drag started");
					draggable.classList.add("dragging");
					// const stuff = draggable.getAttribute("data-stuff");
					var originalContainer = draggable.parentElement.id;
					var originalId = draggable.id;
					var originalDataStuff = draggable.getAttribute("data-stuff");

					console.log("DATA-STUFF ID IS...", originalDataStuff, " WITH an id of...", originalId, " FROM originalContainer...", originalContainer);
				});

				draggable.addEventListener("dragend", () => {
					console.log("drag ended");
					var newContainer = draggable.parentElement.id;
					var newId = draggable.id + 7;
					var newDataStuff = draggable.getAttribute("data-stuff");

					console.log("NEW DATA-STUFF ID IS ... ", newDataStuff, " WITH an id of...", newId, " TO NEW CONTAINER...", newContainer);
					draggable.classList.remove("dragging");
				});
			});

			containers.forEach((container) => {
				container.addEventListener("dragover", (e) => {
					// console.log("drag over");

					e.preventDefault(); // changes cursor to show you can drop

					const afterElement = dragDropEvent(container, e.clientY);
					// console.log("afterElement", afterElement);

					const draggable = document.querySelector(".dragging");

					if (afterElement == null) {
						container.appendChild(draggable);
					} else {
						container.insertBefore(draggable, afterElement);
					}
				});
			});

			// drag and drop between containers USED TO BE getDragAfterElement!!!!!
			function dragDropEvent(container, y) {
				// console.log("DRAGGING container ID... ", container.id);
				// console.log("DRAGGING div ID... ", document.querySelector(".dragging").id);

				// get a list of all draggable elements but NOT the one being dragged in the current container
				const draggablElements = [...container.querySelectorAll(".draggable:not(.dragging)")];

				return draggablElements.reduce(
					(closest, child) => {
						const box = child.getBoundingClientRect();
						// console.log("THIS box is...", box);
						const offset = y - box.top - box.height / 2;
						// console.log(offset);

						if (offset < 0 && offset > closest.offset) {
							return { offset: offset, element: child };
						} else {
							return closest;
						}
					},
					{ offset: Number.NEGATIVE_INFINITY }
				).element;
			}
		</script>
	</body>
</html>
